<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link href="style/default.css" rel="stylesheet">
	<script src="webOSjs-0.1.0/webOS.js" charset="utf-8"></script>
	<script src="lib/jquery/3.3.1/jquery-3.3.1.min.js" charset="utf-8"></script>

	<script>
		/* 즉시 실행 */ 
		$(document).ready(function() {
			realTime();
			//camOn();
			realWeather();
		});
	</script>
</head>
<body>
	<!-- 시작 -->
	<div class="wrapper" id="main" data-chk="false" onclick="javascript:wrapper.closeOropen(); return false;">
		<!-- 시간 출력 부분 -->
		<div class="time" id="timebar">
			<div class="year">
				<span id="year">0</span>
				<span>.</span>
				<span id="month">0</span>
				<span>.</span>
				<span id="date">0</span>
				<span></span>
				<span id="day">월요일</span>
			</div>
			<span id="hour">0</span>
			<span>:</span>
			<span id="minute">0</span>
			<span>:</span>
			<span id="seconds">0</span>
			<span id="ap">AM</span>
			
			<!-- 날씨 출력 부분 -->
			<div class="weather">
				<img src="image/weather_sunny.png" class="weather-icon" id="weather">
				<p class="temp" id="temp">0℃</p>
			</div>
		</div>

		<div class="cam">
			<video id="video" width="100%" height="100%" autoplay></video>
		</div>
	</div>

	<!-- 아이콘 메뉴 출력 부분 -->
	<div class="icon-menu" id="icon-menu">
		<a href="#" onclick="javascript: modal.open(); return false;">
			<img src="image/search_icon.png" class="search-menu-icon">
		</a>
		<img src="image/calendar_icon.png" class="calendar-menu-icon">
	</div>

	<!-- 검색 Modal 부분 -->
	<div class="modal-cover" id="modal">
		<img src="image/w_cancel.png" class="btn-cancel" onclick="javascript: modal.close(); return false;">
		<input type="text" name="search" placeholder="검색어..." id="search_q">
		<div class="btn-search" onclick="javascript: search(); return false;">
			<img src="image/modal_search.png" width="40px" height="auto">
		</div>
	</div>

	<script>
		var wrapper = {
			/* 열기 닫기 함수 */
			'closeOropen': function() {
				var time_bar = document.getElementById("timebar");
				var wrapper = document.getElementById("main");
				var chk = wrapper.getAttribute("data-chk");
				var icon = document.getElementById("icon-menu");

				if(chk == "false") {
					time_bar.style.display = "none";
					icon.style.display = "none";
					wrapper.setAttribute("data-chk", true);

				}else if(chk == "true") {
					time_bar.style.display = "block";
					icon.style.display = "block";
					wrapper.setAttribute("data-chk", false);
				}
			}
		}

		/* 시간 불러오기 함수 */
		function realTime() {
			var date = new Date();
			var timeYear = document.getElementById("year");
			var timeMonth = document.getElementById("month");
			var timeDate = document.getElementById("date");
			var timeDay = document.getElementById("day");
			var timeHour = document.getElementById("hour");
			var timeMinutes = document.getElementById("minute");
			var timeSeconds = document.getElementById("seconds");
			var ap = document.getElementById("ap");
			
			var time = new Array(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getDay(), date.getHours(), date.getMinutes(), date.getSeconds());
			var day = new Array("일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일");
			
			/* 타이머 숫자 앞에 0이 없을 경우 0을 추가하여 작동 */
			for(var i=0; i<time.length; i++) {
				if(time[i] >= 0 && time[i] < 10) time[i] = '0' + time[i];
			}
			
			/* 오후인지 오전인지 출력 */  
			if(time[3] >= 0 && time[3] <= 12) ap.innerHTML = "AM";
			else ap.innerHTML = "PM";
			
			/* 요일 출력 */ 
			for(var i=0; i<time.length; i++) {
				if(time[3] == i) time[3] = day[i];
			}
			
			timeYear.innerHTML = time[0];
			timeMonth.innerHTML = time[1];
			timeDate.innerHTML = time[2];
			timeDay.innerHTML = time[3];
			timeHour.innerHTML = time[4];
			timeMinutes.innerHTML = time[5];
			timeSeconds.innerHTML = time[6];

			//1초마다 재귀
			setTimeout('realTime()', '1000');
		}
		
		/* openweathermap API로 날씨 정보 불러오기 */
		function realWeather() {
			$.ajax({
				type:"GET",
				dataType:"text",
				url:"http://api.openweathermap.org/data/2.5/weather?q=Seoul,kr&appid=717d4ed7e1e4172778523d635debea5d",
				success:function(json){
					// JSON에서 켈빈 온도로 값을 주기 때문에 kelvin 값만큼 빼주어야 함
					const kelvin = 273.15;

					var list = $.parseJSON(json);
					var weather = list.weather[0].icon; // 날씨 불러오기
					var temp = list.main.temp - kelvin; // 온도 켈빈 공식
					var icon = document.getElementById("weather");

					// 온도 출력할 때 소수점 이하 버리기
					temp = Math.floor(temp);
					
					// 날씨 DB
					if(weather == "50n" || weather == "50d") icon.setAttribute("src", "image/weather_mist.png"); // 안개
					else if(weather == "13d" || weather == "13n") icon.setAttribute("src", "image/weather_snow.png"); // 눈
					else if(weather == "09d" || weather == "09n" || weather == "10d" || weather == "10n") icon.setAttribute("src", "image/weather_rain.png"); // 비
					else if(weather == "11d" || weather == "11n") icon.setAttribute("src", "image/weather_thunderstorms.png"); // 번개
					else if(weather == "03d" || weather == "03n" || weather == "04d" || weather == "04n") icon.setAttribute("src", "image/weather_cloudy.png"); // 구름 많이 낌
					else if(weather == "02d" || weather == "02n") icon.setAttribute("src", "image/weather_partly_cloudy.png"); // 구름 조금 낌
					else if(weather == "01d" || weather == "01n") icon.setAttribute("src", "image/weather_sunny.png"); // 맑음
					var display_temp = document.getElementById("temp");
					display_temp.innerHTML = temp + "℃";
					
					setTimeout('realWeather()', '3600000');
				}
			});
		}
		
		/* 웹캠 켜기 함수 */
		function camOn() {
			var video = document.getElementById('video');
			if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
				navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
				video.src = window.URL.createObjectURL(stream);
				video.play();
				});
			}
		}
		
		/* 모달 함수 */
		var modal = {
			'open' : function() {
				var modal = document.getElementById("modal");
				var timebar = document.getElementById("timebar");
				var icon = document.getElementById("icon-menu");
				modal.style.display = "block";
				timebar.style.display = "none";
				icon.style.display = "none";
			},
			'close' : function() {
				var modal = document.getElementById("modal");
				var timebar = document.getElementById("timebar");
				var icon = document.getElementById("icon-menu");
				modal.style.display = "none";
				timebar.style.display = "block";
				icon.style.display = "block";
			}
		}

		function search() {
			var search_string = document.getElementById("search_q").value;
			location.href = "https://www.google.co.kr/search?q=" + search_string;
		}
	</script>
</body>
</html>
